<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>昨夜长风</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="旦旦而学之,久而不怠焉,迄乎成">
    
    <link rel="preload" href="/assets/css/0.styles.eb2a5623.css" as="style"><link rel="preload" href="/assets/js/app.3b1bd9f0.js" as="script"><link rel="preload" href="/assets/js/2.f89b0c75.js" as="script"><link rel="preload" href="/assets/js/4.21756dae.js" as="script"><link rel="prefetch" href="/assets/js/10.b1287e85.js"><link rel="prefetch" href="/assets/js/11.cc2cd01a.js"><link rel="prefetch" href="/assets/js/12.553a8bfe.js"><link rel="prefetch" href="/assets/js/13.988ebc8e.js"><link rel="prefetch" href="/assets/js/14.4bf92d0c.js"><link rel="prefetch" href="/assets/js/15.aa69356d.js"><link rel="prefetch" href="/assets/js/16.d7dc51b9.js"><link rel="prefetch" href="/assets/js/17.d1cada28.js"><link rel="prefetch" href="/assets/js/18.49971797.js"><link rel="prefetch" href="/assets/js/19.cf64d9d2.js"><link rel="prefetch" href="/assets/js/20.6bbebaa1.js"><link rel="prefetch" href="/assets/js/21.07cd6861.js"><link rel="prefetch" href="/assets/js/22.cc4bdb45.js"><link rel="prefetch" href="/assets/js/23.c041b1e1.js"><link rel="prefetch" href="/assets/js/24.8a6bb330.js"><link rel="prefetch" href="/assets/js/25.d55d57b1.js"><link rel="prefetch" href="/assets/js/26.ad0b9a68.js"><link rel="prefetch" href="/assets/js/27.4aad8fc9.js"><link rel="prefetch" href="/assets/js/28.5e0f8be1.js"><link rel="prefetch" href="/assets/js/29.7c336b43.js"><link rel="prefetch" href="/assets/js/3.97ad0728.js"><link rel="prefetch" href="/assets/js/30.81ff334f.js"><link rel="prefetch" href="/assets/js/31.6c7c12af.js"><link rel="prefetch" href="/assets/js/32.baa97aaa.js"><link rel="prefetch" href="/assets/js/33.f0183bda.js"><link rel="prefetch" href="/assets/js/34.c7652b28.js"><link rel="prefetch" href="/assets/js/35.52a33322.js"><link rel="prefetch" href="/assets/js/36.4674c811.js"><link rel="prefetch" href="/assets/js/37.dce97565.js"><link rel="prefetch" href="/assets/js/38.67a646e7.js"><link rel="prefetch" href="/assets/js/39.00846006.js"><link rel="prefetch" href="/assets/js/40.28d2deb6.js"><link rel="prefetch" href="/assets/js/41.61db1ace.js"><link rel="prefetch" href="/assets/js/42.0f49963b.js"><link rel="prefetch" href="/assets/js/43.3a75b561.js"><link rel="prefetch" href="/assets/js/44.6d7d76de.js"><link rel="prefetch" href="/assets/js/45.e37f9184.js"><link rel="prefetch" href="/assets/js/46.6a216979.js"><link rel="prefetch" href="/assets/js/47.0f097446.js"><link rel="prefetch" href="/assets/js/48.882b0c01.js"><link rel="prefetch" href="/assets/js/49.8915e55e.js"><link rel="prefetch" href="/assets/js/5.b56f44f0.js"><link rel="prefetch" href="/assets/js/50.e1856bce.js"><link rel="prefetch" href="/assets/js/51.d1e4b199.js"><link rel="prefetch" href="/assets/js/52.56dbc41d.js"><link rel="prefetch" href="/assets/js/53.5151b29d.js"><link rel="prefetch" href="/assets/js/54.83a12215.js"><link rel="prefetch" href="/assets/js/55.cdd51d29.js"><link rel="prefetch" href="/assets/js/56.2df44741.js"><link rel="prefetch" href="/assets/js/57.2b2e3156.js"><link rel="prefetch" href="/assets/js/58.387104e7.js"><link rel="prefetch" href="/assets/js/59.72dd1cfd.js"><link rel="prefetch" href="/assets/js/6.49f2c7e0.js"><link rel="prefetch" href="/assets/js/60.ebddfe58.js"><link rel="prefetch" href="/assets/js/61.61e405d3.js"><link rel="prefetch" href="/assets/js/62.980bd4b0.js"><link rel="prefetch" href="/assets/js/63.4ddf5880.js"><link rel="prefetch" href="/assets/js/64.8e82fc78.js"><link rel="prefetch" href="/assets/js/65.9ec23a5a.js"><link rel="prefetch" href="/assets/js/66.709eddbb.js"><link rel="prefetch" href="/assets/js/67.ef3550b1.js"><link rel="prefetch" href="/assets/js/68.adc111e8.js"><link rel="prefetch" href="/assets/js/69.cd7c842a.js"><link rel="prefetch" href="/assets/js/7.c27f31c8.js"><link rel="prefetch" href="/assets/js/70.248de5b5.js"><link rel="prefetch" href="/assets/js/71.a16c4947.js"><link rel="prefetch" href="/assets/js/72.a632b046.js"><link rel="prefetch" href="/assets/js/73.0b9dfcf8.js"><link rel="prefetch" href="/assets/js/74.40229535.js"><link rel="prefetch" href="/assets/js/75.da7ce4c9.js"><link rel="prefetch" href="/assets/js/76.0aa269c4.js"><link rel="prefetch" href="/assets/js/77.b0f6ff11.js"><link rel="prefetch" href="/assets/js/78.a4b0c8c2.js"><link rel="prefetch" href="/assets/js/79.04c61ace.js"><link rel="prefetch" href="/assets/js/8.5f97719d.js"><link rel="prefetch" href="/assets/js/80.0c4c6ceb.js"><link rel="prefetch" href="/assets/js/81.c4de4f17.js"><link rel="prefetch" href="/assets/js/82.302000f5.js"><link rel="prefetch" href="/assets/js/83.2ed901a8.js"><link rel="prefetch" href="/assets/js/84.82dc554a.js"><link rel="prefetch" href="/assets/js/85.21dd1f2d.js"><link rel="prefetch" href="/assets/js/86.67a9ce04.js"><link rel="prefetch" href="/assets/js/87.9c711812.js"><link rel="prefetch" href="/assets/js/88.03294f64.js"><link rel="prefetch" href="/assets/js/89.bc90277d.js"><link rel="prefetch" href="/assets/js/9.fb71d21d.js"><link rel="prefetch" href="/assets/js/90.4d78bcee.js"><link rel="prefetch" href="/assets/js/91.e006713c.js"><link rel="prefetch" href="/assets/js/92.331ca364.js"><link rel="prefetch" href="/assets/js/93.32c71ab9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb2a5623.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">昨夜长风</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  知识笔记
</a></div><div class="nav-item"><a href="/article/" class="nav-link">
  舞文弄墨
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习心得" class="dropdown-title"><span class="title">学习心得</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习心得" class="mobile-dropdown-title"><span class="title">学习心得</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/" class="nav-link">
  java
</a></li></ul></li><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/" class="nav-link">
  js
</a></li><li class="dropdown-subitem"><a href="/css/" class="nav-link">
  css
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><span class="title">在线工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="在线工具" class="mobile-dropdown-title"><span class="title">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://smallpdf.com/cn/pdf-to-word" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF 转换器
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://zh.numberempire.com/latexequationeditor.php" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公式编辑器
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.toyaml.com/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  yaml &lt;-&gt; properties
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://qqe2.com/cron" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cron表达式
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://tableconvert.com/?output=text" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MD 表格生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  二维码生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://tool.chinaz.com/Tools/Base64.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  base64加密解密
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON 格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="精彩博客" class="dropdown-title"><span class="title">精彩博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="精彩博客" class="mobile-dropdown-title"><span class="title">精彩博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://cmsblogs.com/?page_id=3027" target="_blank" rel="noopener noreferrer" class="nav-link external">
  技术驿站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.iocoder.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  芋道源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://xjjdog.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小姐姐味道
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnkirito.moe/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Kirito
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.flydean.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  程序那些事
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://icyfenix.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  凤凰架构
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/doocs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Doocs技术社区
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/521xueweihan/HelloGitHub" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hello,github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.funtl.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  noFound
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  知识笔记
</a></div><div class="nav-item"><a href="/article/" class="nav-link">
  舞文弄墨
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习心得" class="dropdown-title"><span class="title">学习心得</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习心得" class="mobile-dropdown-title"><span class="title">学习心得</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/" class="nav-link">
  java
</a></li></ul></li><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/" class="nav-link">
  js
</a></li><li class="dropdown-subitem"><a href="/css/" class="nav-link">
  css
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><span class="title">在线工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="在线工具" class="mobile-dropdown-title"><span class="title">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://smallpdf.com/cn/pdf-to-word" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF 转换器
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://zh.numberempire.com/latexequationeditor.php" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公式编辑器
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.toyaml.com/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  yaml &lt;-&gt; properties
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://qqe2.com/cron" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cron表达式
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://tableconvert.com/?output=text" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MD 表格生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  二维码生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://tool.chinaz.com/Tools/Base64.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  base64加密解密
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON 格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="精彩博客" class="dropdown-title"><span class="title">精彩博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="精彩博客" class="mobile-dropdown-title"><span class="title">精彩博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://cmsblogs.com/?page_id=3027" target="_blank" rel="noopener noreferrer" class="nav-link external">
  技术驿站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.iocoder.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  芋道源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://xjjdog.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小姐姐味道
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnkirito.moe/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Kirito
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.flydean.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  程序那些事
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://icyfenix.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  凤凰架构
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/doocs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Doocs技术社区
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/521xueweihan/HelloGitHub" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hello,github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.funtl.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  noFound
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>mysql核心知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/mysql_core.html" class="sidebar-link">mysql进阶知识</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>mysql日志</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/mysql_log.html" class="sidebar-link">mysql日志</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>mysql索引</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/mysql_index.html" aria-current="page" class="active sidebar-link">mysql索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_1-1、索引的本质" class="sidebar-link">1.1、索引的本质</a></li><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_1-2、b-tree和b-tree" class="sidebar-link">1.2、B-Tree和B+Tree</a></li><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_1-3、为什么使用b-tree" class="sidebar-link">1.3、为什么使用B+Tree</a></li><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_1-4、b-tree索引的性能分析" class="sidebar-link">1.4、B-/+Tree索引的性能分析</a></li><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_2-1、myisam索引实现" class="sidebar-link">2.1、MyISAM索引实现</a></li><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_2-2、innodb索引实现" class="sidebar-link">2.2、InnoDB索引实现</a></li><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_3-1、最左前缀原理与相关优化" class="sidebar-link">3.1、最左前缀原理与相关优化</a></li><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_3-2、索引选择性与前缀索引" class="sidebar-link">3.2、索引选择性与前缀索引</a></li><li class="sidebar-sub-header"><a href="/mysql/mysql_index.html#_3-3、innodb的主键选择与优化" class="sidebar-link">3.3、InnoDB的主键选择与优化</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>mysql设计规范</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/mysql_design.html" class="sidebar-link">mysql设计规范</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>mysql优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/mysql_optimize.html" class="sidebar-link">mysql优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>mybatis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/mybatis.html" class="sidebar-link">mybatis</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>本文以MySQL数据库为研究对象，讨论与数据库索引相关的一些话题。特别需要说明的是，MySQL支持诸多存储引擎，而各种存储引擎对索引的支持也各不相同，因此MySQL数据库支持多种索引类型，如BTree索引，哈希索引，全文索引等等。为了避免混乱，本文将只关注于BTree索引，因为这是平常使用MySQL时主要打交道的索引，至于哈希索引和全文索引本文暂不讨论。</p> <p>文章主要内容分为四个部分：</p> <p>第一部分主要从数据结构以及计算机主存、磁盘存取的层面讨论MySQL数据库索引。</p> <p>第二部分主要讨论MySQL中不同引擎（主要讲解MyISAM和InnoDB）的B-Tree索引对比，包括聚集索引、非聚集索引等话题。</p> <p>第三部分根据上面的理论基础，讨论MySQL中高性能使用索引的策略。</p> <p>第四部分根据实际案例分析慢查询以及如何进行优化。</p> <p>第五部分是标注的参考的文章。</p> <h1 id="_1、索引的数据结构以及算法基础"><a href="#_1、索引的数据结构以及算法基础" class="header-anchor">#</a> 1、索引的数据结构以及算法基础</h1> <h2 id="_1-1、索引的本质"><a href="#_1-1、索引的本质" class="header-anchor">#</a> 1.1、索引的本质</h2> <p>MySQL官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构。提取句子主干，就可以得到索引的本质：索引是一种数据结构。</p> <p>数据库查询是数据库的主要功能之一，最基本的查询算法是顺序查找（linear search）时间复杂度为O(n)，显然在数据量很大时效率很低。优化的查找算法如二分查找（binary search）、二叉树查找（binary tree search）等，虽然查找效率提高了。但是各自对检索的数据都有要求：二分查找要求被检索数据有序，而二叉树查找只能应用于二叉查找树上，但是数据本身的组织结构不可能完全满足各种数据结构（例如，理论上不可能同时将两列都按顺序进行组织）。所以，在数据之外，数据库系统还维护着满足特定查找算法的数据结构。这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法。这种数据结构就是索引。</p> <p>看一个例子：</p> <p><img src="/assets/img/suoyin1.02b9ab0e.png" alt="img"></p> <p>上图展示了一种可能的索引方式。左边是数据表，一共有两列七条记录，最左边的是数据记录的物理地址（注意逻辑上相邻的记录在磁盘上也并不是一定物理相邻的）。为了加快Col2的查找，可以维护一个右边所示的二叉查找树，每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找在O(log2n)的复杂度内获取到相应数据。</p> <p>虽然这是一个货真价实的索引，但是实际的数据库系统几乎没有使用二叉查找树或其进化品种红黑树（red-black tree）实现的，原因会在下文介绍。</p> <h2 id="_1-2、b-tree和b-tree"><a href="#_1-2、b-tree和b-tree" class="header-anchor">#</a> 1.2、B-Tree和B+Tree</h2> <p>关于B树和B+树请参考：<a href="http://www.cnblogs.com/tgycoder/p/5077017.html" target="_blank" rel="noopener noreferrer">关于B树的一些总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这篇文章介绍的比较详细，同时容易理解。</p> <p>目前大部分数据库系统及文件系统都采用B-Tree或其变种B+Tree作为索引结构，在本文的下一节会结合存储器原理及计算机存取原理讨论为什么B-Tree和B+Tree在被如此广泛用于索引，这一节先单纯从数据结构角度简单的描述它们。</p> <h3 id="b-tree"><a href="#b-tree" class="header-anchor">#</a> B-Tree</h3> <p>B-Tree树的特点：</p> <ol><li>所有键值分布在整个树中</li> <li>任何关键字出现且只出现在一个节点中</li> <li>搜索有可能在非叶子节点结束</li> <li>在关键字全集内做一次查找，性能逼近二分查找算法</li></ol> <p>下图是B-Tree的一个示意图</p> <p><img src="/assets/img/suoyin2.8bf1c431.png" alt="img"></p> <h3 id="b-tree-2"><a href="#b-tree-2" class="header-anchor">#</a> B+Tree</h3> <p>B-Tree有许多变种，其中最常见的是B+Tree，例如MySQL就普遍使用B+Tree实现其索引结构。</p> <p>与B-Tree相比，B+Tree有以下不同点：</p> <ol><li>所有关键字存储在叶子节点，非叶子节点不存储真正的data</li> <li>为所有叶子节点增加了一个链指针</li></ol> <p>下图是一个简单的B+Tree示意。</p> <p><img src="/assets/img/suoyin3.4064017b.png" alt="img"></p> <p>一般来说，B+Tree比B-Tree更适合实现外存储索引结构，具体原因与外存储器原理及计算机存取原理有关，将在下面讨论。</p> <h3 id="带有顺序访问指针的b-tree"><a href="#带有顺序访问指针的b-tree" class="header-anchor">#</a> 带有顺序访问指针的B+Tree</h3> <p>一般在数据库系统或文件系统中使用的B+Tree结构都在经典B+Tree的基础上进行了优化，增加了顺序访问指针。</p> <p><img src="/assets/img/suoyin4.dd784a8e.png" alt="img"></p> <p>如上图所示，在B+Tree的每个叶子结点增加一个指向相邻叶子结点的指针，就形成了带有顺序访问指针的B+Tree。做这个优化的目的是为了提高区间访问的性能，如果要查询key为从18到49的所有数据记录，当找到18后，只需顺着结点和指针顺序遍历就可以一次性访问到所有数据结点，极大提到了区间查询效率。</p> <h2 id="_1-3、为什么使用b-tree"><a href="#_1-3、为什么使用b-tree" class="header-anchor">#</a> 1.3、为什么使用B+Tree</h2> <p>上文说过，红黑树等数据结构也可以用来实现索引，但是文件系统及数据库系统普遍采用B-/+Tree作为索引结构，这一节将结合计算机组成原理相关知识讨论B-/+Tree作为索引的理论基础。</p> <p>一般来说，索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储的磁盘上。这样的话，索引查找过程中就要产生磁盘I/O消耗，相对于内存存取，I/O存取的消耗要高几个数量级，所以评价一个数据结构作为索引的优劣最重要的指标就是在查找过程中磁盘I/O操作次数的渐进复杂度。换句话说，索引的结构组织要尽量减少查找过程中磁盘I/O的存取次数。下面先介绍内存和磁盘存取原理，然后再结合这些原理分析B-/+Tree作为索引的效率。</p> <h3 id="主存存取原理"><a href="#主存存取原理" class="header-anchor">#</a> 主存存取原理</h3> <p>目前计算机使用的主存基本都是随机读写存储器（RAM），现代RAM的结构和存取原理比较复杂，这里本文抛却具体差别，抽象出一个十分简单的存取模型来说明RAM的工作原理。</p> <p><img src="/assets/img/suoyin5.306aae99.png" alt="img"></p> <p>从抽象角度看，主存是一系列的存储单元组成的矩阵，每个存储单元存储固定大小的数据。每个存储单元有唯一的地址，现代主存的编址规则比较复杂，这里将其简化成一个二维地址：通过一个行地址和一个列地址可以唯一定位到一个存储单元。上图展示了一个4 x 4的主存模型。</p> <p>主存的存取过程如下：</p> <p>当系统需要读取主存时，则将地址信号放到地址总线上传给主存，主存读到地址信号后，解析信号并定位到指定存储单元，然后将此存储单元数据放到数据总线上，供其它部件读取。</p> <p>写主存的过程类似，系统将要写入单元地址和数据分别放在地址总线和数据总线上，主存读取两个总线的内容，做相应的写操作。</p> <p>这里可以看出，主存存取的时间仅与存取次数呈线性关系，因为不存在机械操作，两次存取的数据的“距离”不会对时间有任何影响，例如，先取A0再取A1和先取A0再取D3的时间消耗是一样的。</p> <h3 id="磁盘存取原理"><a href="#磁盘存取原理" class="header-anchor">#</a> 磁盘存取原理</h3> <p>上文说过，索引一般以文件形式存储在磁盘上，索引检索需要磁盘I/O操作。与主存不同，磁盘I/O存在机械运动耗费，因此磁盘I/O的时间消耗是巨大的。</p> <p>下图是磁盘的整体结构示意图。</p> <p><img src="data:image/png;base64,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IHDzWti5/PmBS7/gWZR/R0c9O/llShaEJJcW710YTf3UaUknXiCLqrocWdCZFzyexefM8wmLYP730lRmvCF//UpIMp2tof/XbveBZ2HEt7n5ejj/r39WYFFPuSKLejipVCcI3Arf/GeabHR++UHO4vB3gVF5v6P+d+bS7964uyf5L+G7aQ5gWc7i0DoJTxahqi5HNtO8yc7Otekqjvl158ZuwbPA2zj4fuqGHORKpuR40NR5EvMgl2HTvFXtLngWzIb8+XQFFvWUK7Koh5NKdYbAfIZiNuMx/SzkFaZpT//dAVHsCfvzJJzdu497t2czBJY/8Oss5vUshCGze12+xNd15kq4fven8Pl+XYv37+6HIcg7ces5rNzebMmebAfPLbTHvth79tJyC57Moiz76yxWyl9PuSKLejiplBBYRODOziKZZIrP5uafwocXzx+W7gjyiywyVbLEygmB/4Xruy50CHvrHOKsFU/a0Jln8eczUeQXWSRVlSofDAKFkMavWci5jZDFbOPpP/4+PPnYY+Ex+/zuD6W7s5Xtlmb/E1nkrGnJJgQaIsAeqOtus7iqPMct/B8uaG8mRW58rwAAAABJRU5ErkJggg==" alt="img"></p> <p>一个磁盘由大小相同且同轴的圆形盘片组成，磁盘可以转动（各个磁盘必须同步转动）。在磁盘的一侧有磁头支架，磁头支架固定了一组磁头，每个磁头负责存取一个磁盘的内容。磁头不能转动，但是可以沿磁盘半径方向运动（实际是斜切向运动），每个磁头同一时刻也必须是同轴的，即从正上方向下看，所有磁头任何时候都是重叠的（不过目前已经有多磁头独立技术，可不受此限制）。</p> <p>下图是磁盘结构的示意图。</p> <p><img src="/assets/img/suoyin7.d3b3e8b8.png" alt="img"></p> <p>盘片被划分成一系列同心环，圆心是盘片中心，每个同心环叫做一个磁道，所有半径相同的磁道组成一个柱面。磁道被沿半径线划分成一个个小的段，每个段叫做一个扇区，每个扇区是磁盘的最小存储单元。为了简单起见，我们下面假设磁盘只有一个盘片和一个磁头。</p> <p>当需要从磁盘读取数据时，系统会将数据逻辑地址传给磁盘，磁盘的控制电路按照寻址逻辑将逻辑地址翻译成物理地址，即确定要读的数据在哪个磁道，哪个扇区。为了读取这个扇区的数据，需要将磁头放到这个扇区上方，为了实现这一点，磁头需要移动对准相应磁道，这个过程叫做寻道，所耗费时间叫做寻道时间，然后磁盘旋转将目标扇区旋转到磁头下，这个过程耗费的时间叫做旋转时间。</p> <h3 id="局部性原理与磁盘预读"><a href="#局部性原理与磁盘预读" class="header-anchor">#</a> 局部性原理与磁盘预读</h3> <p>由于存储介质的特性，磁盘本身存取就比主存慢很多，再加上机械运动耗费，磁盘的存取速度往往是主存的几百分分之一，因此为了提高效率，要尽量减少磁盘I/O。为了达到这个目的，磁盘往往不是严格按需读取，而是每次都会预读，即使只需要一个字节，磁盘也会从这个位置开始，顺序向后读取一定长度的数据放入内存。这样做的理论依据是计算机科学中著名的局部性原理：</p> <blockquote><p><strong>当一个数据被用到时，其附近的数据也通常会马上被使用。程序运行期间所需要的数据通常比较集中。</strong></p></blockquote> <p>由于磁盘顺序读取的效率很高（不需要寻道时间，只需很少的旋转时间），因此对于具有局部性的程序来说，预读可以提高I/O效率。</p> <p>预读的长度一般为页（page）的整倍数。页是计算机管理存储器的逻辑块，硬件及操作系统往往将主存和磁盘存储区分割为连续的大小相等的块，每个存储块称为一页（在许多操作系统中，页得大小通常为4k），主存和磁盘以页为单位交换数据。当程序要读取的数据不在主存中时，会触发一个缺页异常，此时系统会向磁盘发出读盘信号，磁盘会找到数据的起始位置并向后连续读取一页或几页载入内存中，然后异常返回，程序继续运行。</p> <h2 id="_1-4、b-tree索引的性能分析"><a href="#_1-4、b-tree索引的性能分析" class="header-anchor">#</a> 1.4、B-/+Tree索引的性能分析</h2> <p>从使用磁盘I/O次数评价索引结构的优劣性：根据B-Tree的定义，可知检索一次最多需要访问h个结点。数据库系统的设计者巧妙的利用了磁盘预读原理，将一个结点的大小设为等于一个页面，这样每个结点只需要一次I/O就可以完全载入。为了达到这个目的，在实际实现B-Tree还需要使用如下技巧：</p> <p>每次新建结点时，直接申请一个页面的空间，这样可以保证一个结点的大小等于一个页面，加之计算机存储分配都是按页对齐的，就实现了一个node只需一次I/O。</p> <p>B-Tree中一次检索最多需要h-1次I/O（根结点常驻内存），渐进复杂度为O(h)=O(logdN)。一般实际应用中，出读d是非常大的数字，通常超过100，因此h非常小。</p> <p>综上所述，用B-Tree作为索引结构效率是非常高的。</p> <p>而红黑树结构，h明显要深得多。由于逻辑上很近的结点（父子结点）物理上可能离得很远，无法利用局部性原理。所以即使红黑树的I/O渐进复杂度也为O(h)，但是查找效率明显比B-Tree差得多。</p> <p>B+Tree更适合外存索引，是和内结点出度d有关。从上面分析可以看到，d越大索引的性能越好，而出度的上限取决于结点内key和data的大小：<strong>dmax=floor(pagesize/(keysize+datasize+pointsize))</strong>。</p> <p>floor表示向下取整。由于B+Tree内结点去掉了data域，因此可以拥有更大的出度，拥有更好的性能。</p> <p>这一章从理论角度讨论了与索引相关的数据结构与算法问题，下一章将讨论B+Tree是如何具体实现为MySQL中索引，同时将结合MyISAM和InnDB存储引擎介绍非聚集索引和聚集索引两种不同的索引实现形式。</p> <h1 id="_2、mysql索引实现"><a href="#_2、mysql索引实现" class="header-anchor">#</a> 2、MySQL索引实现</h1> <p>在MySQL中，索引属于存储引擎级别的概念，不同存储引擎对索引的实现方式是不同的，本文主要讨论MyISAM和InnoDB两个存储引擎(<a href="http://www.cnblogs.com/tgycoder/p/5410096.html" target="_blank" rel="noopener noreferrer">MySQL数据库MyISAM和InnoDB存储引擎的比较<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)的索引实现方式。</p> <h2 id="_2-1、myisam索引实现"><a href="#_2-1、myisam索引实现" class="header-anchor">#</a> 2.1、MyISAM索引实现</h2> <p>MyISAM引擎使用B+Tree作为索引结构，叶结点的data域存放的是数据记录的地址。下面是MyISAM索引的原理图：</p> <p><img src="/assets/img/suoyin8.e18bbdd3.png" alt="img"></p> <p>这里设表一共有三列，假设我们以Col1为主键，则上图是一个MyISAM表的聚簇索引（Primary key）示意。可以看出MyISAM的索引文件仅仅保存数据记录的地址。在MyISAM中，主索引和二级索引（Secondary key）在结构上没有任何区别，只是主索引要求key是唯一的，而二级索引的key可以重复。如果我们在Col2上建立一个二级索引，则此索引的结构如下图所示：</p> <p><img src="/assets/img/suoyin9.406e43ed.png" alt="img"></p> <p>同样也是一颗B+Tree，data域保存数据记录的地址。因此，MyISAM中索引检索的算法为首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则取出其data域的值，然后以data域的值为地址，读取相应数据记录。</p> <p>MyISAM的索引方式也叫做“非聚集”的，之所以这么称呼是为了与InnoDB的聚集索引区分。</p> <h2 id="_2-2、innodb索引实现"><a href="#_2-2、innodb索引实现" class="header-anchor">#</a> 2.2、InnoDB索引实现</h2> <p>虽然InnoDB也使用B+Tree作为索引结构，但具体实现方式却与MyISAM截然不同。</p> <p>第一个重大区别是InnoDB的数据文件本身就是索引文件。从上文知道，MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶结点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是聚簇索引。</p> <p><img src="/assets/img/suoyin10.fadf00f1.png" alt="img"></p> <p>上图是InnoDB主索引（同时也是数据文件）的示意图，可以看到叶结点包含了完整的数据记录。这种索引叫做聚簇索引（也叫聚集索引）。因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。</p> <p>第二个与MyISAM索引的不同是InnoDB的二级索引data域存储相应记录主键的值而不是地址。换句话说，InnoDB的所有二级索引都引用主键作为data域。例如，下图为定义在Col3上的一个二级索引：</p> <p><img src="/assets/img/suoyin11.f5575b50.png" alt="img"></p> <p>这里以英文字符的ASCII码作为比较准则。聚簇索引这种实现方式使得按主键的搜索十分高效，但是二级索引搜索需要检索两遍索引：首先检索二级索引获得主键，然后用主键到主索引中检索获得记录。</p> <p>了解不同存储引擎的索引实现方式对于正确使用和优化索引都非常有帮助，例如知道了InnoDB的索引实现后，就很容易明白为什么不建议使用过长的字段作为主键，因为所有二级索引都引用主索引，过长的主索引会令二级索引变得过大。再例如，用非单调的字段作为主键在InnoDB中不是个好主意，因为InnoDB数据文件本身是一颗B+Tree，非单调的主键会造成在插入新记录时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效，而使用自增字段作为主键则是一个很好的选择。</p> <p>下一章将具体讨论这些与索引有关的优化策略。</p> <h1 id="_3、索引使用策略以及优化"><a href="#_3、索引使用策略以及优化" class="header-anchor">#</a> 3、索引使用策略以及优化</h1> <p>MySQL的优化主要分为结构优化（Scheme optimization）和查询优化（Query optimization）。本章讨论的高性能索引策略主要属于结构优化范畴。本章的内容完全基于上文的理论基础，实际上一旦理解了索引背后的机制，那么选择高性能的策略就变成了纯粹的推理，并且可以理解这些策略背后的逻辑。</p> <p>根据之前章节的介绍，我们再来总结一下<strong>索引的优点</strong>：</p> <ol><li>索引大大减少了服务器需要扫描的数据量。</li> <li>索引可以帮助服务器避免排序和临时表。（B-Tree索引存储的数据是有顺序的，可以直接用来做ORDER BY和GROUP BY操作）</li> <li>索引可以将随机I/O变为顺序I/O。</li></ol> <p><strong>索引对如下类型的查询有效</strong></p> <ol><li>全值匹配：全值匹配指的是和索引中所有列进行匹配。</li> <li>匹配最左前缀。</li> <li>匹配列前缀：匹配某一列值的开头部分。</li> <li>匹配范围值（索引列顺序存储的特性）。</li> <li>精确匹配某一列并范围匹配另外一列。</li> <li>只访问索引的查询。</li></ol> <p><strong>当然，索引也存在一些限制</strong></p> <ol><li>不是按照索引的最左列开始查找，则无法使用索引。</li> <li>不能跳过索引中的列。</li> <li>如果查询中某个列是范围查询，则其右边所有的列都无法使用索引优化查找。</li></ol> <p>下面我们来针对索引的策略来进行一些具体的分析：</p> <blockquote><p>Note: 为了讨论索引策略，需要一个数据量不算小的数据库作为示例。本文选用MySQL官方文档中提供的示例数据库之一：<a href="https://launchpad.net/test-db/employees-db-1/1.0.6" target="_blank" rel="noopener noreferrer">employees<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这个数据库关系复杂度适中，且数据量较大。</p> <p>为了理解下面explain的具体用法，推荐先看一下这篇关于explain详解的文章：<a href="http://benjaminwhx.com/2018/02/23/MySQL%E4%BC%98%E5%8C%96%E4%B9%8BEXPLAIN%E8%AF%A6%E8%A7%A3/" target="_blank" rel="noopener noreferrer">MySQL优化之EXPLAIN详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="_3-1、最左前缀原理与相关优化"><a href="#_3-1、最左前缀原理与相关优化" class="header-anchor">#</a> 3.1、最左前缀原理与相关优化</h2> <p>高效使用索引的首要条件是知道什么样的查询会使用到索引，这个问题和B+Tree中的“最左前缀原理”有关，下面通过例子说明最左前缀原理。</p> <p>这里先说一下联合索引的概念。在上文中，我们都是假设索引只引用了单个的列，实际上，MySQL中的索引可以以一定顺序引用多个列，这种索引叫做联合索引，一般的，一个联合索引是一个有序元组，其中各个元素均为数据表的一列，实际上要严格定义索引需要用到关系代数，但是这里我不想讨论太多关系代数的话题，因为那样会显得很枯燥，所以这里就不再做严格定义。另外，单列索引可以看成联合索引元素数为1的特例。</p> <p>以employees.titles表为例，下面先查看其上都有哪些索引：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>  <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+</span>
<span class="token operator">|</span> titles <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>  <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> emp_no      <span class="token operator">|</span> A         <span class="token operator">|</span>        <span class="token boolean">NULL</span> <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>
<span class="token operator">|</span> titles <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>  <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span> title       <span class="token operator">|</span> A         <span class="token operator">|</span>        <span class="token boolean">NULL</span> <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>
<span class="token operator">|</span> titles <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>  <span class="token operator">|</span>            <span class="token number">3</span> <span class="token operator">|</span> from_date   <span class="token operator">|</span> A         <span class="token operator">|</span>      <span class="token number">443308</span> <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>
<span class="token operator">|</span> titles <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> emp_no   <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> emp_no      <span class="token operator">|</span> A         <span class="token operator">|</span>      <span class="token number">443308</span> <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>从结果中可以到titles表的主索引为<code>&lt;emp_no, title, from_date&gt;</code>，还有一个辅助索引<code>&lt;emp_no&gt;</code>。为了避免多个索引使事情变复杂（MySQL的SQL优化器在多索引时行为比较复杂），这里我们将辅助索引drop掉：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> emp_no<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样就可以专心分析索引PRIMARY的行为了。</p> <h3 id="_3-1-1、全值匹配"><a href="#_3-1-1、全值匹配" class="header-anchor">#</a> 3.1.1、全值匹配</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no<span class="token operator">=</span><span class="token string">'10001'</span> <span class="token operator">AND</span> title<span class="token operator">=</span><span class="token string">'Senior Engineer'</span> <span class="token operator">AND</span> from_date<span class="token operator">=</span><span class="token string">'1986-06-26'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">59</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>很明显，当按照索引中所有列进行精确匹配（这里精确匹配指“=”或“IN”匹配）时，索引可以被用到。这里有一点需要注意，理论上索引对顺序是敏感的，但是由于MySQL的查询优化器会自动调整where子句的条件顺序以使用适合的索引，例如我们将where中的条件顺序颠倒效果也是一样的：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> from_date<span class="token operator">=</span><span class="token string">'1986-06-26'</span> <span class="token operator">AND</span> emp_no<span class="token operator">=</span><span class="token string">'10001'</span> <span class="token operator">AND</span> title<span class="token operator">=</span><span class="token string">'Senior Engineer'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">59</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-1-2、匹配最左前缀"><a href="#_3-1-2、匹配最左前缀" class="header-anchor">#</a> 3.1.2、匹配最左前缀</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no<span class="token operator">=</span><span class="token string">'10001'</span> <span class="token operator">AND</span> title<span class="token operator">=</span><span class="token string">'Senior Engineer'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len  <span class="token operator">|</span> ref          <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">56</span>       <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>       <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看到上面的索引用到了<code>&lt;emp_no, title&gt;</code>索引，符合最左原则，下面我们来分析用不到索引的情况：</p> <h4 id="不是按照最左列开始查找"><a href="#不是按照最左列开始查找" class="header-anchor">#</a> 不是按照最左列开始查找</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> from_date<span class="token operator">=</span><span class="token string">'1986-06-26'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">443308</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>由于不是最左前缀，索引这样的查询显然用不到索引。</p> <h4 id="跳过索引中的列"><a href="#跳过索引中的列" class="header-anchor">#</a> 跳过索引中的列</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no<span class="token operator">=</span><span class="token string">'10001'</span> <span class="token operator">AND</span> from_date<span class="token operator">=</span><span class="token string">'1986-06-26'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>由于<code>&lt;emp_no, from_date&gt;</code>不是索引中连续的字段，所以from_date显然用不到索引，需要在服务器层进行where过滤。</p> <h3 id="_3-1-3、匹配列前缀"><a href="#_3-1-3、匹配列前缀" class="header-anchor">#</a> 3.1.3、匹配列前缀</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no<span class="token operator">=</span><span class="token string">'10001'</span> <span class="token operator">AND</span> title <span class="token operator">LIKE</span> <span class="token string">'Senior%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> range <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">56</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>此时可以用到索引，like中如果通配符%不出现在开头，则可以用到索引。</p> <h3 id="_3-1-4、匹配范围值"><a href="#_3-1-4、匹配范围值" class="header-anchor">#</a> 3.1.4、匹配范围值</h3> <p>我们用explain来查看索引时，type=range可以代表语句中有范围查询，但是mysql并不会区分<strong>范围索引和多值匹配</strong>，而范围索引（小于、大于等）不会使用索引中该字段后面的列，而多值匹配（BETWEEN AND、IN等）则会使用索引中该字段后面的列。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no <span class="token operator">&lt;</span> <span class="token string">'10010'</span> <span class="token operator">and</span> title<span class="token operator">=</span><span class="token string">'Senior Engineer'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> range <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>   <span class="token number">16</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看到索引中<code>&lt;title&gt;</code>并没有被用上。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10010</span><span class="token punctuation">,</span><span class="token number">10011</span><span class="token punctuation">)</span> <span class="token operator">and</span> title<span class="token operator">=</span><span class="token string">'Senior Engineer'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len  <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span><span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> range <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">56</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no <span class="token operator">BETWEEN</span> <span class="token number">10010</span> <span class="token operator">AND</span> <span class="token number">10011</span> <span class="token operator">and</span> title<span class="token operator">=</span><span class="token string">'Senior Engineer'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len  <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> range <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">56</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>   <span class="token number">15</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>可以发现上面两个例子都用到了<code>&lt;emp_no, title&gt;</code>。</p> <h3 id="_3-1-5、查询条件中含有函数或表达式"><a href="#_3-1-5、查询条件中含有函数或表达式" class="header-anchor">#</a> 3.1.5、查询条件中含有函数或表达式</h3> <p>很不幸，如果查询条件中含有函数或表达式，则MySQL不会为这列使用索引（虽然某些在数学意义上可以使用）。例如：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no<span class="token operator">=</span><span class="token string">'10001'</span> <span class="token operator">AND</span> <span class="token keyword">left</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'Senior'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>由于使用了函数left，则无法为title列应用索引。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles <span class="token keyword">WHERE</span> emp_no <span class="token operator">-</span> <span class="token number">1</span><span class="token operator">=</span><span class="token string">'10000'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> titles <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">443308</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>显然这个查询等价于查询emp_no为10001的函数，但是由于查询条件是一个表达式，MySQL无法为其使用索引。看来MySQL还没有智能到自动优化常量表达式的程度，因此在写查询语句时尽量避免表达式出现在查询中，而是先手工私下代数运算，转换为无表达式的查询语句。</p> <h3 id="_3-1-6、排序"><a href="#_3-1-6、排序" class="header-anchor">#</a> 3.1.6、排序</h3> <p>MySQL有两种方式可以生成有序的结果：一种是通过排序操作（非引擎端排序而是服务端排序）；或者按照索引顺序扫描。如果EXPLAIN出来的type列的值为“index”，则说明MySQL使用了索引扫描来做排序。</p> <p>因为使用索引扫描数据是非常快的，如果扫描完数据并且还可以进行排序的话，那效率肯定是最高的。但是这样做我们一定得保证<strong>索引中列的顺序和ORDER BY子句的顺序完全一致，并且所有列的方向（倒序或正序）都一样，如果在where条件中存在索引列，不能是范围条件。如果查询需要关联多张表，ORDER BY子句引用的字段全部要是第一个表的。简言之：最左前缀原则</strong>。这样才可以利用索引扫描来做排序。</p> <p>我们把上面的索引<code>&lt;emp_no, title, from_date&gt;</code> 改为 <code>&lt;emp_no, title, from_date, to_date&gt;</code></p> <p>下面是几个可以使用索引排序的例子：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">// 第一列是常量 + 最左前缀</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> emp_no <span class="token operator">=</span> <span class="token string">'xxx'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> title<span class="token punctuation">,</span> from_date<span class="token punctuation">;</span>
<span class="token comment">// 最左前缀，order by后面列的方向都一致</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> emp_no <span class="token operator">=</span> <span class="token string">'xxx'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> title <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token comment">// 最左前缀，order by后面列的方向都一致</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> emp_no <span class="token operator">=</span> <span class="token string">'xxx'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> title <span class="token keyword">desc</span><span class="token punctuation">,</span> from_date <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>下面是一些不能使用索引做排序的查询：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">// order by后面列的方向不一致</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> emp_no <span class="token operator">=</span> <span class="token string">'xxx'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> title <span class="token keyword">asc</span><span class="token punctuation">,</span> c <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token comment">// d不在索引中</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> emp_no <span class="token operator">=</span> <span class="token string">'xxx'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> title<span class="token punctuation">,</span> to_date<span class="token punctuation">;</span>
<span class="token comment">// 不是最左前缀原则</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> emp_no <span class="token operator">=</span> <span class="token string">'xxx'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> from_date<span class="token punctuation">;</span>
<span class="token comment">// 范围条件</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> emp_no <span class="token operator">&gt;</span> <span class="token string">'xxx'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> title<span class="token punctuation">,</span> from_date<span class="token punctuation">;</span>
<span class="token comment">// 对于排序来说，in也是范围条件</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> emp_no <span class="token operator">&gt;</span> <span class="token string">'xxx'</span> <span class="token operator">and</span> title <span class="token operator">in</span> <span class="token punctuation">(</span>xx<span class="token punctuation">,</span> xx<span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> from_date<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3-1-7、临界值问题"><a href="#_3-1-7、临界值问题" class="header-anchor">#</a> 3.1.7、临界值问题</h3> <p>我遇到过一个问题，同样的sql（条件值不同）有的使用索引有的不使用，这是为什么呢？</p> <p>例如，在 rental 表中，表的总行数为 16044 行；</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 不使用索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> rental <span class="token keyword">WHERE</span> customer_id<span class="token operator">&gt;</span><span class="token number">492</span><span class="token punctuation">;</span>
<span class="token comment">-- 使用索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> rental <span class="token keyword">WHERE</span> customer_id<span class="token operator">&gt;</span><span class="token number">493</span><span class="token punctuation">;</span>
<span class="token comment">-- 其中 id &gt; 492 的行数为 2772, id &gt; 493 的行数为 2749</span>

<span class="token comment">-- 不使用索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> rental <span class="token keyword">WHERE</span> customer_id<span class="token operator">&lt;</span><span class="token number">103</span><span class="token punctuation">;</span>
<span class="token comment">-- 使用索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> rental <span class="token keyword">WHERE</span> customer_id<span class="token operator">&lt;</span><span class="token number">102</span><span class="token punctuation">;</span>
<span class="token comment">-- 其中 id &lt; 103 的行数为 2767, id &lt; 102 的行数为 2734</span>

<span class="token comment">-- 不使用索引，count(*) 为 2758 条</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> rental <span class="token keyword">WHERE</span> customer_id<span class="token operator">&gt;</span><span class="token number">100</span> <span class="token operator">AND</span> customer_id <span class="token operator">&lt;</span> <span class="token number">202</span><span class="token punctuation">;</span>
<span class="token comment">-- 使用索引, count(*) 为 2733 条</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> rental <span class="token keyword">WHERE</span> customer_id<span class="token operator">&gt;</span><span class="token number">100</span> <span class="token operator">AND</span> customer_id <span class="token operator">&lt;</span> <span class="token number">201</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>原来优化器会在索引存在的情况下，通过符合 RANGE 范围的条数和总数的比例来选择是使用索引还是进行全表遍历，当需要读取的数据超过一个临界值时，优化器会放弃从索引中读取而改为进行全表扫描，这是为了避免过多的 random disk。</p> <h2 id="_3-2、索引选择性与前缀索引"><a href="#_3-2、索引选择性与前缀索引" class="header-anchor">#</a> 3.2、索引选择性与前缀索引</h2> <p>既然索引可以加快查询速度，那么是不是只要是查询语句需要，就建上索引？答案是否定的。因为索引虽然加快了查询速度，但索引也是有代价的：索引文件本身要消耗存储空间，同时索引会加重插入、删除和修改记录时的负担，另外，MySQL在运行时也要消耗资源维护索引，因此索引并不是越多越好。一般两种情况下不建议建索引。</p> <p>第一种情况是表记录比较少，例如一两千条甚至只有几百条记录的表，没必要建索引，让查询做全表扫描就好了。至于多少条记录才算多，这个个人有个人的看法，我个人的经验是以2000作为分界线，记录数不超过 2000可以考虑不建索引，超过2000条可以酌情考虑索引。</p> <p>另一种不建议建索引的情况是索引的选择性较低。所谓索引的选择性（Selectivity），是指不重复的索引值（也叫基数，Cardinality）与表记录数（#T）的比值：</p> <p><strong>Index Selectivity = Cardinality / #T</strong></p> <p>显然选择性的取值范围为(0, 1]，选择性越高的索引价值越大，这是由B+Tree的性质决定的。</p> <p><strong>这个问题就像是面试时提问我的一个问题：性别列适不适合建立索引？</strong></p> <p>例如，上文用到的employees.titles表，如果title字段经常被单独查询，是否需要建索引，我们看一下它的选择性：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Selectivity <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>titles<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> Selectivity <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>      <span class="token number">0.0000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>title的选择性不足0.0001（精确值为0.00001579），所以实在没有什么必要为其单独建索引。</p> <p>有一种与索引选择性有关的索引优化策略叫做前缀索引，就是用列的前缀代替整个列作为索引key，当前缀长度合适时，可以做到既使得前缀索引的选择性接近全列索引，同时因为索引key变短而减少了索引文件的大小和维护开销。下面以employees.employees表为例介绍前缀索引的选择和使用。</p> <p>employees表只有一个索引<code>&lt;emp_no&gt;</code>，那么如果我们想按名字搜索一个人，就只能全表扫描了，如果频繁按名字搜索员工，这样显然效率很低，因此我们可以考虑建索引。有两种选择，建<code>&lt;first_name&gt;</code>或<code>&lt;first_name, last_name&gt;</code>，看下两个索引的选择性：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span><span class="token punctuation">(</span>first_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Selectivity <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>employees<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> Selectivity <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>      <span class="token number">0.0042</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span><span class="token punctuation">(</span>concat<span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> last_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Selectivity <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>employees<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> Selectivity <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>      <span class="token number">0.9313</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>&lt;first_name&gt;</code>显然选择性太低，<code>&lt;first_name, last_name&gt;</code>选择性很好，但是first_name和last_name加起来长度为30，有没有兼顾长度和选择性的办法？可以考虑用first_name和last_name的前几个字符建立索引，例如<code>&lt;first_name, left(last_name, 3)&gt;</code>，看看其选择性：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span><span class="token punctuation">(</span>concat<span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Selectivity <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>employees<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> Selectivity <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>      <span class="token number">0.7879</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>选择性还不错，但离0.9313还是有点距离，那么把last_name前缀加到4：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span><span class="token punctuation">(</span>concat<span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Selectivity <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>employees<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> Selectivity <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>      <span class="token number">0.9007</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这时选择性已经很理想了，而这个索引的长度只有18，比短了接近一半，我们把这个前缀索引 建上：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employees<span class="token punctuation">.</span>employees
<span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> first_name_last_name4 <span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> last_name<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时再执行一遍按名字查询，比较分析一下与建索引前的结果：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> PROFILES<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> Query_ID <span class="token operator">|</span> Duration   <span class="token operator">|</span> Query                                                                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------------------------------------------------------+</span>
<span class="token operator">|</span>       <span class="token number">87</span> <span class="token operator">|</span> <span class="token number">0.11941700</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>employees <span class="token keyword">WHERE</span> first_name<span class="token operator">=</span><span class="token string">'Eric'</span> <span class="token operator">AND</span> last_name<span class="token operator">=</span><span class="token string">'Anido'</span> <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token number">90</span> <span class="token operator">|</span> <span class="token number">0.00092400</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">.</span>employees <span class="token keyword">WHERE</span> first_name<span class="token operator">=</span><span class="token string">'Eric'</span> <span class="token operator">AND</span> last_name<span class="token operator">=</span><span class="token string">'Anido'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>性能的提升是显著的，查询速度提高了120多倍。</p> <p>前缀索引兼顾索引大小和查询速度，但是其缺点是不能用于ORDER BY和GROUP BY操作，也不能用于Covering index（即当索引本身包含查询所需全部数据时，不再访问数据文件本身）。</p> <h2 id="_3-3、innodb的主键选择与优化"><a href="#_3-3、innodb的主键选择与优化" class="header-anchor">#</a> 3.3、InnoDB的主键选择与优化</h2> <p>在使用InnoDB存储引擎时，如果没有特别的需要，请永远使用一个与业务无关的自增字段作为主键。</p> <p>经常看到有帖子或博客讨论主键选择问题，有人建议使用业务无关的自增主键，有人觉得没有必要，完全可以使用如学号或身份证号这种唯一字段作为主键。不论支持哪种论点，大多数论据都是业务层面的。如果从数据库索引优化角度看，使用InnoDB引擎而不使用自增主键绝对是一个糟糕的主意。</p> <p>上文讨论过InnoDB的索引实现，InnoDB使用聚集索引，数据记录本身被存于主索引（一颗B+Tree）的叶子节点上。这就要求同一个叶子节点内（大小为一个内存页或磁盘页）的各条数据记录按主键顺序存放，因此每当有一条新的记录插入时，MySQL会根据其主键将其插入适当的节点和位置，如果页面达到装载因子（InnoDB默认为15/16），则开辟一个新的页（节点）。</p> <p>如果表使用自增主键，那么每次插入新的记录，记录就会顺序添加到当前索引节点的后续位置，当一页写满，就会自动开辟一个新的页。如下图所示：</p> <p><img src="/assets/img/suoyin12.b59e4c57.png" alt="img"></p> <p>这样就会形成一个紧凑的索引结构，近似顺序填满。由于每次插入时也不需要移动已有数据，因此效率很高，也不会增加很多开销在维护索引上。</p> <p>如果使用非自增主键（如果身份证号或学号等），由于每次插入主键的值近似于随机，因此每次新纪录都要被插到现有索引页得中间某个位置：</p> <p><img src="data:image/png;base64,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" alt="img"></p> <p>此时MySQL不得不为了将新记录插到合适位置而移动数据，甚至目标页面可能已经被回写到磁盘上而从缓存中清掉，此时又要从磁盘上读回来，这增加了很多开销，同时频繁的移动、分页操作造成了大量的碎片，得到了不够紧凑的索引结构，后续不得不通过OPTIMIZE TABLE来重建表并优化填充页面。</p> <p><strong>因此，只要可以，请尽量在InnoDB上采用自增字段做主键。</strong></p> <h1 id="_4、慢查询优化"><a href="#_4、慢查询优化" class="header-anchor">#</a> 4、慢查询优化</h1> <p>下面通过几个真实场景的例子来看看如何进行优化。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span>
   <span class="token keyword">distinct</span> cert<span class="token punctuation">.</span>emp_id 
<span class="token keyword">from</span>
   cm_log cl 
<span class="token keyword">inner</span> <span class="token keyword">join</span>
   <span class="token punctuation">(</span>
      <span class="token keyword">select</span>
         emp<span class="token punctuation">.</span>id <span class="token keyword">as</span> emp_id<span class="token punctuation">,</span>
         emp_cert<span class="token punctuation">.</span>id <span class="token keyword">as</span> cert_id 
      <span class="token keyword">from</span>
         employee emp 
      <span class="token keyword">left</span> <span class="token keyword">join</span>
         emp_certificate emp_cert 
            <span class="token keyword">on</span> emp<span class="token punctuation">.</span>id <span class="token operator">=</span> emp_cert<span class="token punctuation">.</span>emp_id 
      <span class="token keyword">where</span>
         emp<span class="token punctuation">.</span>is_deleted<span class="token operator">=</span><span class="token number">0</span>
   <span class="token punctuation">)</span> cert 
      <span class="token keyword">on</span> <span class="token punctuation">(</span>
         cl<span class="token punctuation">.</span>ref_table<span class="token operator">=</span><span class="token string">'Employee'</span> 
         <span class="token operator">and</span> cl<span class="token punctuation">.</span>ref_oid<span class="token operator">=</span> cert<span class="token punctuation">.</span>emp_id
      <span class="token punctuation">)</span> 
      <span class="token operator">or</span> <span class="token punctuation">(</span>
         cl<span class="token punctuation">.</span>ref_table<span class="token operator">=</span><span class="token string">'EmpCertificate'</span> 
         <span class="token operator">and</span> cl<span class="token punctuation">.</span>ref_oid<span class="token operator">=</span> cert<span class="token punctuation">.</span>cert_id
      <span class="token punctuation">)</span> 
<span class="token keyword">where</span>
   cl<span class="token punctuation">.</span>last_upd_date <span class="token operator">&gt;=</span><span class="token string">'2013-11-07 15:03:00'</span> 
   <span class="token operator">and</span> cl<span class="token punctuation">.</span>last_upd_date<span class="token operator">&lt;=</span><span class="token string">'2013-11-08 16:00:00'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>先运行一下，53条记录 1.87秒，又没有用聚合语句，比较慢。下面是EXPLAIN的结果</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token operator">+</span><span class="token comment">----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys                   <span class="token operator">|</span> <span class="token keyword">key</span>                   <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span>  <span class="token operator">|</span> Extra                          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> cl         <span class="token operator">|</span> range <span class="token operator">|</span> cm_log_cls_id<span class="token punctuation">,</span>idx_last_upd_date <span class="token operator">|</span> idx_last_upd_date     <span class="token operator">|</span> <span class="token number">8</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span>              <span class="token operator">|</span>   <span class="token number">379</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">temporary</span>   <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>derived2<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token operator">|</span> <span class="token keyword">ALL</span>   <span class="token operator">|</span> <span class="token boolean">NULL</span>                            <span class="token operator">|</span> <span class="token boolean">NULL</span>                  <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>              <span class="token operator">|</span> <span class="token number">63727</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">join</span> buffer <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> DERIVED     <span class="token operator">|</span> emp        <span class="token operator">|</span> <span class="token keyword">ALL</span>   <span class="token operator">|</span> <span class="token boolean">NULL</span>                            <span class="token operator">|</span> <span class="token boolean">NULL</span>                  <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>              <span class="token operator">|</span> <span class="token number">13317</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span>                    <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> DERIVED     <span class="token operator">|</span> emp_cert   <span class="token operator">|</span> ref   <span class="token operator">|</span> emp_certificate_empid           <span class="token operator">|</span> emp_certificate_empid <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> meituanorg<span class="token punctuation">.</span>emp<span class="token punctuation">.</span>id <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span>                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>简述一下执行计划</p> <p>首先mysql根据idx_last_upd_date索引扫描cm_log表获得379条记录；</p> <p>然后查表扫描了63727条记录，分为两部分，derived表示构造表，也就是不存在的表，可以简单理解成是一个语句形成的结果集，后面的数字表示语句的ID。derived2表示的是ID = 2的查询构造了虚拟表，并且返回了63727条记录。</p> <p>我们再来看看ID = 2的语句究竟做了写什么返回了这么大量的数据，首先全表扫描employee表13317条记录，然后根据索引emp_certificate_empid关联emp_certificate表，rows = 1表示，每个关联都只锁定了一条记录，效率比较高。</p> <p>获得后，再和cm_log的379条记录根据规则关联。从执行过程上可以看出返回了太多的数据，返回的数据绝大部分cm_log都用不到，因为cm_log只锁定了379条记录。</p> <p>如何优化呢？可以看到我们在运行完后还是要和cm_log做join,那么我们能不能之前和cm_log做join呢？</p> <p>仔细分析语句不难发现，其基本思想是如果cm_log的ref_table是EmpCertificate就关联emp_certificate表，如果ref_table是Employee就关联employee表，我们完全可以拆成两部分，并用union连接起来。</p> <p>注意这里用union，而不用union all是因为原语句有“distinct”来得到唯一的记录，而union恰好具备了这种功能。如果原语句中没有distinct不需要去重，我们就可以直接使用union all了，因为使用union需要去重的动作，会影响SQL性能。</p> <p>优化过的语句如下</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span>
   emp<span class="token punctuation">.</span>id 
<span class="token keyword">from</span>
   cm_log cl 
<span class="token keyword">inner</span> <span class="token keyword">join</span>
   employee emp 
      <span class="token keyword">on</span> cl<span class="token punctuation">.</span>ref_table <span class="token operator">=</span> <span class="token string">'Employee'</span> 
      <span class="token operator">and</span> cl<span class="token punctuation">.</span>ref_oid <span class="token operator">=</span> emp<span class="token punctuation">.</span>id  
<span class="token keyword">where</span>
   cl<span class="token punctuation">.</span>last_upd_date <span class="token operator">&gt;=</span><span class="token string">'2013-11-07 15:03:00'</span> 
   <span class="token operator">and</span> cl<span class="token punctuation">.</span>last_upd_date<span class="token operator">&lt;=</span><span class="token string">'2013-11-08 16:00:00'</span> 
   <span class="token operator">and</span> emp<span class="token punctuation">.</span>is_deleted <span class="token operator">=</span> <span class="token number">0</span>  
<span class="token keyword">union</span>
<span class="token keyword">select</span>
   emp<span class="token punctuation">.</span>id 
<span class="token keyword">from</span>
   cm_log cl 
<span class="token keyword">inner</span> <span class="token keyword">join</span>
   emp_certificate ec 
      <span class="token keyword">on</span> cl<span class="token punctuation">.</span>ref_table <span class="token operator">=</span> <span class="token string">'EmpCertificate'</span> 
      <span class="token operator">and</span> cl<span class="token punctuation">.</span>ref_oid <span class="token operator">=</span> ec<span class="token punctuation">.</span>id  
<span class="token keyword">inner</span> <span class="token keyword">join</span>
   employee emp 
      <span class="token keyword">on</span> emp<span class="token punctuation">.</span>id <span class="token operator">=</span> ec<span class="token punctuation">.</span>emp_id  
<span class="token keyword">where</span>
   cl<span class="token punctuation">.</span>last_upd_date <span class="token operator">&gt;=</span><span class="token string">'2013-11-07 15:03:00'</span> 
   <span class="token operator">and</span> cl<span class="token punctuation">.</span>last_upd_date<span class="token operator">&lt;=</span><span class="token string">'2013-11-08 16:00:00'</span> 
   <span class="token operator">and</span> emp<span class="token punctuation">.</span>is_deleted <span class="token operator">=</span> <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>用改造后的语句实验一下，只需要10ms 降低了近200倍！</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token operator">+</span><span class="token comment">----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type  <span class="token operator">|</span> <span class="token keyword">table</span>      <span class="token operator">|</span> <span class="token keyword">type</span>   <span class="token operator">|</span> possible_keys                   <span class="token operator">|</span> <span class="token keyword">key</span>               <span class="token operator">|</span> key_len <span class="token operator">|</span> ref                   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>      <span class="token operator">|</span> cl         <span class="token operator">|</span> range  <span class="token operator">|</span> cm_log_cls_id<span class="token punctuation">,</span>idx_last_upd_date <span class="token operator">|</span> idx_last_upd_date <span class="token operator">|</span> <span class="token number">8</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span>                  <span class="token operator">|</span>  <span class="token number">379</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>      <span class="token operator">|</span> emp        <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>                         <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>           <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> meituanorg<span class="token punctuation">.</span>cl<span class="token punctuation">.</span>ref_oid <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">UNION</span>        <span class="token operator">|</span> cl         <span class="token operator">|</span> range  <span class="token operator">|</span> cm_log_cls_id<span class="token punctuation">,</span>idx_last_upd_date <span class="token operator">|</span> idx_last_upd_date <span class="token operator">|</span> <span class="token number">8</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span>                  <span class="token operator">|</span>  <span class="token number">379</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">UNION</span>        <span class="token operator">|</span> ec         <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token keyword">PRIMARY</span><span class="token punctuation">,</span>emp_certificate_empid   <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>           <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> meituanorg<span class="token punctuation">.</span>cl<span class="token punctuation">.</span>ref_oid <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>             <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">UNION</span>        <span class="token operator">|</span> emp        <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>                         <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>           <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> meituanorg<span class="token punctuation">.</span>ec<span class="token punctuation">.</span>emp_id  <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token keyword">UNION</span> RESULT <span class="token operator">|</span> <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>union1<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token operator">|</span> <span class="token keyword">ALL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>                            <span class="token operator">|</span> <span class="token boolean">NULL</span>              <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>                  <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h1 id="_5、参考"><a href="#_5、参考" class="header-anchor">#</a> 5、参考</h1> <p><a href="http://www.cnblogs.com/tgycoder/p/5410057.html" target="_blank" rel="noopener noreferrer">MySQL索引背后的数据结构及算法原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://blog.jobbole.com/86594/" target="_blank" rel="noopener noreferrer">MySQL索引原理及慢查询优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/0371c9569736" target="_blank" rel="noopener noreferrer">以B tree和B+ tree的区别来分析mysql索引实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Mysql底层结构选择 B+Tree</strong></p> <p>1、为什么不二分查找法作索引？</p> <p>解释：<strong>前提是有序</strong>，不适合做索引</p> <p>2、为什么不使用二叉树做索引？</p> <p>解释：二叉树虽然简单，但是<strong>树的高度太高，不适合用做索引</strong></p> <p>3、为什么不使用平衡二叉树做索引？</p> <p>解释：与二叉树对比，高度会自动平衡，<strong>虽然解决了二叉树的高度问题，但是解决的不透彻</strong>，高度依然没有得到很好的改善</p> <p>4、为什么不使用BTree？（多路平衡数，一个节点存储多个数据）</p> <p>解释：高度得到很好的控制，等值（=）查询时，效率特别高，但是<strong>Mysql会大量使用范围查询</strong>（&lt;、&gt;等），<strong>BTree对于这些查询不友好，效率特别低</strong></p> <p>5、B+Tree</p> <p>会把数据存到叶子一份，叶子是单向关联（数据库是双向关联），<strong>有序，对于范围条件查询，效率高</strong></p> <p>如下图</p> <p><img src="/assets/img/20191010222928937.5feaeab8.png" alt="img"></p> <h3 id="b-tree分析"><a href="#b-tree分析" class="header-anchor">#</a> B+Tree分析</h3> <p><strong>引擎：</strong></p> <ul><li>B+Tree，根据不同的储存引擎，不一样存储，一般是Innodb和MyISAM</li> <li>Innodb是聚集索引（也叫聚合索引），MyISAM是非聚集索引</li> <li>聚集索引意思是索引和数据存放在一起，在B+Tree的叶子节点中，在mysql中也是在存放同一个文件中 .ibd （data+index）</li> <li>非聚集索引意思是索引和数据不是存放在一起，只有索引是在叶子节点，在mysql中分开存储在两个文件中.MYD （data 数据）、.MYI （index 索引）</li></ul> <p><strong>为什么主键尽量选择整型而不选择字符串？</strong></p> <p>分析：</p> <ol><li>假设varchar（20），那varchar的长度就是20*3=60，还有加上6个长度记录位置信息，所以就是66B</li> <li>在数据库中一页一个节点16K，那一个节点能存储多少数据？就是16*1024/66=248</li> <li>如果是int，4+6=10B，一个节点能存储16*1024/10=1638</li></ol> <p>结论：</p> <p>这就看出差距了，一个节点存越多数据，相当于层数越低，寻址次数越少</p> <p>所以在工作中，尽量能不用varchar，就不用，能使用数值就用数值做主键，提高性能</p> <p><strong>树的高度为3的情况下，Mysql能存多少数据？</strong></p> <p>假设使用主键bigint 长度为8</p> <p>pk bigint：8+6B=14B（除开8之外，还有要6个长度记录位置信息（官方规定），一个数据包括数据和紧跟其后的位置指针，就是一个数据占有14B的长度）</p> <p>Innodb_page_size：16K（show variables like 'innodb_page_size'）<strong>page：是mysql里面的逻辑存储单元，大小是16384B=16K，B+Tree一个节点可以理解成一个页</strong></p> <p>数据计算：</p> <p>1、第一行只有一个节点：16K，存放的是索引，需要14B大小</p> <p>计算一个节点可以存放多少个数据：16K*1024B/14B=1170个数据</p> <p>2、第二行，第一行一个数据对应第二行一个节点，其中一个节点又是16k：数据1170*1170=1368900</p> <p>3、第三行不仅存放索引，考虑还要存放数据</p> <p>一个节点16K，一个数据为1k（一个数据不是14B了，需要占用更多内存，理论上很多表都是为1K）</p> <p>那一个节点就是16/1=16个数据</p> <p>第三行量为数据=1368900*16=2190,2400</p> <p><strong>结论：叶子节点存的就是数据，所以树的高度为3的情况下，mysql大概能存多少数据2000w数据</strong></p> <p>下面是我针对自己假想的一张表，表的数据比较少，三层大概能存4亿多数据（<strong>B+树数据写错了，排序</strong>）</p> <p><img src="/assets/img/20191010231547785.4a6262d9.png" alt="img"></p> <p>MySQL 索引使用的注意事项</p> <p>索引不会包含有 NULL 的列 只要列中包含有 NULL 值，都将不会被包含在索引中，复合索引中只要有一列含有 NULL 值，那么这一列对于此符合索引就是无效的。</p> <p>使用短索引 对串列进行索引，如果可以就应该指定一个前缀长度。例如，如果有一个 char（255） 的列，如果在前 10 个或 20 个字符内，多数值是唯一的，那么就不要对整个列进行索引。短索引不仅可以提高查询速度而且可以节省磁盘空间和 I/O 操作。</p> <p>索引列排序 MySql 查询只使用一个索引，因此如果 where 子句中已经使用了索引的话，那么 order by 中的列是不会使用索引的。因此数据库默认排序可以符合要求的情况下不要使用排序操作，尽量不要包含多个列的排序，如果需要最好给这些列建复合索引。</p> <p>like 语句操作 一般情况下不鼓励使用 like 操作，如果非使用不可，注意正确的使用方式。like ‘%aaa%’ 不会使用索引，而 like ‘aaa%’ 可以使用索引。</p> <p>不要在列上进行运算</p> <p>不使用 NOT IN 、&lt;&gt;、！=操作，但 &lt; , &lt;= ，= ，&gt; , &gt;= , BETWEEN , IN 是可以用到索引的</p> <p>索引要建立在经常进行select操作的字段上 这是因为，如果这些列很少用到，那么有无索引并不能明显改变查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求。</p> <p>索引要建立在值比较唯一的字段上</p> <p>对于那些定义为 text、image 和 bit 数据类型的列不应该增加索引。因为这些列的数据量要么相当大，要么取值很少</p> <p>在 where 和 join 中出现的列需要建立索引</p> <p>where 的查询条件里有不等号 (where column != …) , MySql 将无法使用索引</p> <p>如果 where 字句的查询条件里使用了函数(如：where DAY(column)=…), MySql 将无法使用索引</p> <p>在 join 操作中(需要从多个数据表提取数据时)，MySql 只有在主键和外键的数据类型相同时才能使用索引，否则及时建立了索引也不会使用</p> <p>①B+树的层级更少：相较于B树B+每个非叶子节点存储的关键字数更多，树的层级更少所以查询数据更快。
②B+树查询速度更稳定：B+所有关键字数据地址都存在叶子节点上，所以每次查找的次数都相同所以查询速度要比B树更稳定。
③B+树天然具备排序功能：B+树所有的叶子节点数据构成了一个有序链表，在查询大小区间的数据时候更方便，数据紧密性很高，缓存的命中率也会比B树高。
④B+树全节点遍历更快：B+树遍历整棵树只需要遍历所有的叶子节点即可，而不需要像B树对每一层进行遍历，这有利于数据库做全表扫描。
⑤B树相对于B+树的优点是，如果经常访问的数据离根节点很近，而B树的非叶子节点本身存有关键字其数据的地址，所以这种数据检索的时候会要比B+树快。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/12/4 下午7:26:15</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mysql/mysql_log.html" class="prev">
        mysql日志
      </a></span> <span class="next"><a href="/mysql/mysql_design.html">
        mysql设计规范
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.3b1bd9f0.js" defer></script><script src="/assets/js/2.f89b0c75.js" defer></script><script src="/assets/js/4.21756dae.js" defer></script>
  </body>
</html>
