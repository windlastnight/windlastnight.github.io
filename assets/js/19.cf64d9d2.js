(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{376:function(t,e,l){t.exports=l.p+"assets/img/mysql.37f40898.png"},489:function(t,e,l){"use strict";l.r(e);var v=l(25),_=Object(v.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("p",[t._v("我们用一个场景来串联一些概念：当我们要更新一条数据并查询")]),t._v(" "),v("p",[t._v("1、执行器要去调数据引擎检查这条数据所在的数据页在不在内存")]),t._v(" "),v("p",[t._v("2、不在内存中，非唯一索引将这个更新对应数据页操作记录在"),v("code",[t._v("ChangeBuffer")]),t._v("中（唯一索引会读去数据磁盘将数据页读入内存）")]),t._v(" "),v("p",[t._v("3、"),v("code",[t._v("Undo Log Buffer")]),t._v("记录这个更新操作的相反逻辑，属于逻辑日记（更新+3，记录-3；删除，记录插入记录；）")]),t._v(" "),v("p",[t._v("4、"),v("code",[t._v("Redo Log Buffer")]),t._v("记录"),v("code",[t._v("ChangeBuffer")]),t._v("的改变，属于物理日记，此时更新二阶段提交状态为第一阶段"),v("code",[t._v("prepare")]),t._v("，引擎层记录")]),t._v(" "),v("p",[t._v("5、"),v("code",[t._v("Binlog Buffer")]),t._v("记录这个更新逻辑操作，"),v("code",[t._v("Server")]),t._v("层记录")]),t._v(" "),v("p",[t._v("6、提交事务，此时更新二阶段提交状态为第二阶段"),v("code",[t._v("commit")])]),t._v(" "),v("p",[t._v("7、各个Buffer都有自己的刷盘时机，将内存中的日记通过"),v("code",[t._v("OS Buffer")]),t._v("写到日记磁盘中，即"),v("code",[t._v("Undo Log File")]),t._v("、"),v("code",[t._v("Redo Log File")]),t._v("和"),v("code",[t._v("Binlog File")])]),t._v(" "),v("p",[t._v("8、查询数据时，对应的数据页不在内存中，此时需要将数据页同步到内存中，并执行"),v("code",[t._v("merge")]),t._v("过程")]),t._v(" "),v("p",[t._v("9、线程空闲时等将内存中最新的数据页写入数据磁盘中，这个过程叫刷脏")]),t._v(" "),v("p",[t._v("概念解释表格")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"left"}},[t._v("概念")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("解释（红：核心，绿：过程，黄：指引）")])])]),t._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("数据页")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("MySQL是按照数据页为最小单位进行存储的，b+树的特性，一页默认16k，数据属于页，页包含数据\\。当操作一条数据的时候，实际上就是在操作一个数据页，多条数据可能是在一个数据页也可能是在多个数据页，看数据具体分布。后面对我将会一直提到数据页。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("内存")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("内存是指：InnoDB引擎内存Buffer Pool，会缓存数据页。每次更新之前查数据先会查内存中对应的数据页。由内存Buffer Pool分割出去的有ChangeBuffer、Log Buffer（Redo、Undo）和Binlog Buffer等等。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("ChangeBuffer")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“ChangeBuffer” 是Buffer Pool分割出去的一块内存，记录更新操作，当更新没有用到唯一索引并且内存没有对应数据页，就不用从数据磁盘读入到内存，而是直接记录在ChangeBuffer中。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Log Buffer")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“Log Buffer” 是Buffer Pool分割出去的一块内存总称，事务日记内存，Log Buffer又分成Redo log Buffer和Undo Log Buffer。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("数据磁盘")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“数据磁盘” 是数据库存储数据的磁盘（自称） ，为了区分日记磁盘")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Undo Log Buffer")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("Log Buffer的一块缓存，写Undo是先写入Undo Log Buffer，刷盘时机，通过OS Buffer写入Undo Log File日记磁盘。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("逻辑日记")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“逻辑日记” 可以简单理解为记录的就是sql语句。Binlog和Undo log记录的是逻辑日记。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Redo Log Buffer")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("Log Buffer的一块缓存，写Rndo是先写入Redo Log Buffer，刷盘时机，通过OS Buffer写入Redo Log File日记磁盘。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("物理日记")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“物理日志” 记录的就是数据页变更 ，因为MySQL数据最终是保存在数据页中的，Redo Log记录e的是物理日记。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("二阶段提交")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“二阶段提交” 是指prepare和commit两个状态阶段，是保证Redo log 和 Binlog一致性所采取的方式。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("prepare")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“prepare” 是指预提交阶段，属于二阶段提交中的第一阶段。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Binlog Buffer")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“Binlog Buffer” 是Buffer Pool分出的一块内存，除了查询操作的SQL都要进行记录在Binlog Buffer中，刷盘时机，通过OS Buffer写入Binlog File日记磁盘文件。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Server")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“Server” 是MySQL基本架构的一层，MySQL基本架构分为Server层和引擎层")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("commit")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“commit” 是指预提交阶段，属于二阶段提交中的第二阶段。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("刷盘时机")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“刷盘时机” 是指啥时候，通过什么策略将内存日记中写入到日记磁盘中。因为日记每次都是先写入内存buffer中，然后通过刷盘时机设置的参数控制刷盘时机，最后才刷入日记磁盘。这个参数设置对于Undo、Redo和Binlog都有一套参数。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("OS Buffer")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v('“OS Buffer" 是指操作系统内存，数据库将内存中日记写入到日记磁盘都要经过操作系统的OS Buffer来间接写入。')])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("日记磁盘")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“日记磁盘” 是指写入到磁盘的日记文件的统称，我将日记文件统称为日记磁盘好区分数据磁盘。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Undo Log FileRedo Log FileBinLog File")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("是指写入到磁盘的日记文件，每个文件在内存中都有对应内容，最终都会写入到日记磁盘中。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("merge")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“merge” 是指将ChangeBuffer应用到内存中的，得到最新的内存页，并将数据页的改动记录到Redo中的一个过程。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("刷脏")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("“刷脏” 是指将内存的脏数据页刷到数据磁盘中，内存中的数据页是最新的和数据磁盘不同步时，将内存的数据页称为脏数据，数据库会在线程空闲或者其他时机将 “内存中的脏数据页” 刷到 “数据磁盘”中。")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Log sequence number")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("当前的redo log(in buffer)中的LSN，系统最大最新的LSN值，我叫它：redo log buffer lsn")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Log flushed up to")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("已经刷到日记磁盘中的LSN，我叫它：redo log file lsn")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Pages flushed up")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("已经刷到数据磁盘数据页上的LSN，每个数据页头部会记录一个LSN，我叫它：data disk lsn--额外加：内存中的LSN，我叫它：data buffer lsn")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("Last checkpoint at")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("日记磁盘上一次检查点记录的LSN，只有数据刷完才会记录。即小于此值的LSN的数据页一定已经刷入数据磁盘，大于的可能已经刷入，可能未刷入。我叫它：checkpoint lsn")])])])]),t._v(" "),v("p",[t._v("二、进阶知识图片串联\n"),v("img",{attrs:{src:l(376),alt:"mysql"}})])])}),[],!1,null,null,null);e.default=_.exports}}]);